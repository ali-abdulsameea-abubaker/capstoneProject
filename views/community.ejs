<%- include('partials/header', {title: 'Community'}) %>

<div class="row">
  <div class="col-12">
    <h1 class="mb-4">Community</h1>
  </div>
</div>

<div class="row">
  <div class="col-lg-8">
    <!-- Create Post Form -->
    <div class="card card-custom mb-4">
      <div class="card-body p-4">
        <h3 class="h5 mb-3">Create a Post</h3>
        <form action="/community" method="POST">
          <div class="mb-3">
            <label for="title" class="form-label">Title</label>
            <input type="text" class="form-control" id="title" name="title" required>
          </div>
          <div class="mb-3">
            <label for="content" class="form-label">Content</label>
            <textarea class="form-control" id="content" name="content" rows="4" required></textarea>
          </div>
          <button type="submit" class="btn btn-custom">Post</button>
        </form>
      </div>
    </div>

    <!-- Community Posts -->
    <div class="card card-custom">
      <div class="card-body p-4">
        <h2 class="h4 mb-4">Latest Posts</h2>
        
        <% if (posts && posts.length) { %>
          <% posts.forEach(post => { %>
            <div class="community-post card mb-4">
              <div class="card-body">
                <h3 class="h5 card-title"><%= post.title %></h3>
                <p class="card-text"><%= post.content %></p>
                <div class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    by <%= post.username %> • <%= new Date(post.created_at).toLocaleString() %>
                  </small>
                </div>
                
                <!-- Comment Form -->
                <form action="/community/<%= post.post_id %>/comments" method="POST" class="mt-3">
                  <div class="input-group">
                    <input type="text" class="form-control" name="content" placeholder="Write a comment..." required>
                    <button class="btn btn-outline-primary" type="submit">Comment</button>
                  </div>
                </form>
              </div>
            </div>
          <% }); %>
        <% } else { %>
          <p class="text-center text-muted">No posts yet. Be the first to share something!</p>
        <% } %>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <div class="col-lg-4">
    <div class="card card-custom">
      <div class="card-body p-4">
        <h3 class="h5 mb-3">Community Guidelines</h3>
        <ul class="list-unstyled">
          <li class="mb-2">✅ Be kind and respectful to others</li>
          <li class="mb-2">✅ Share helpful information and tips</li>
          <li class="mb-2">✅ Ask questions about pet care</li>
          <li class="mb-2">❌ No spam or self-promotion</li>
          <li>❌ No inappropriate content</li>
        </ul>
      </div>
    </div>

    <div class="card card-custom mt-4">
      <div class="card-body p-4">
        <h3 class="h5 mb-3">Quick Actions</h3>
        <div class="d-grid gap-2">
          <a href="/dashboard" class="btn btn-outline-primary">← Back to Dashboard</a>
          <a href="/pets/add" class="btn btn-outline-secondary">Add New Pet</a>
          <a href="/schedule-task" class="btn btn-outline-secondary">Schedule Task</a>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('partials/footer') %>